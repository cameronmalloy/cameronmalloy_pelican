<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Bay Area Twitter Sentiment During a Pandemic</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="/ba-sentiment.html" rel="canonical" />
  <!-- Feed -->

  <link href="/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="/theme/css/code_blocks/github.css" rel="stylesheet">


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->



    <meta name="description" content="What is the overall sentiment of the bay area? What is the distribution of this sentiment? What are people happy or sad about in a given...">

    <meta name="author" content="Cameron Malloy">

    <meta name="tags" content="NLP">
    <meta name="tags" content="Deep Learning">
    <meta name="tags" content="Clustering">




<!-- Open Graph -->
<meta property="og:site_name" content="spectral decomp"/>
<meta property="og:title" content="Bay Area Twitter Sentiment During a Pandemic"/>
<meta property="og:description" content="What is the overall sentiment of the bay area? What is the distribution of this sentiment? What are people happy or sad about in a given..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/ba-sentiment.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-05-06 15:30:00-07:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/cameron-malloy.html">
<meta property="article:section" content="Data Science"/>
<meta property="article:tag" content="NLP"/>
<meta property="article:tag" content="Deep Learning"/>
<meta property="article:tag" content="Clustering"/>
<meta property="og:image" content="/theme/images/post-bg.jpg">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Bay Area Twitter Sentiment During a Pandemic",
  "headline": "Bay Area Twitter Sentiment During a Pandemic",
  "datePublished": "2020-05-06 15:30:00-07:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Cameron Malloy",
    "url": "/author/cameron-malloy.html"
  },
  "image": "/theme/images/post-bg.jpg",
  "url": "/ba-sentiment.html",
  "description": "What is the overall sentiment of the bay area? What is the distribution of this sentiment? What are people happy or sad about in a given..."
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>

              <li role="presentation"><a href="/pages/home.html">Home</a></li>

    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" >
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="/" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Bay Area Twitter Sentiment During a Pandemic</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="/author/cameron-malloy.html">Cameron Malloy</a>
            | <time datetime="06 May 2020">06 May 2020</time>
        </span>
        <!-- TODO : Modified check -->
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p><em>What is the overall sentiment of the bay area? What is the distribution of this sentiment? What are people happy or sad about in a given area?</em></p>
<h2>Introduction</h2>
<p>The San Francisco Bay Area is home to a very diverse population. There are many different people from different racial profiles.</p>
<figure>
<img alt="img not found" src="/assets/ba_sentiment_assets/ba_race_demos.jpg">
<figcaption>
Data taken from <a href="http://www.bayareacensus.ca.gov/bayarea.htm">http://www.bayareacensus.ca.gov/bayarea.htm</a><br>
Original data is from the <em>2010 United States Census Summary File 1</em>. United States Census Bureau
</figcaption></figure>
<p>What's more interesting is that individuals of the same race tend to live around each other. The reasons behind this could be due to a multitude of reasons. One may be a want to be near social connections. Another may be housing, employment, and police discrimination, separating races.</p>
<p><strong>Race and Ethnicity 2010 - San Francisco Bay Area</strong></p>
<p><center>
<figure markdown="span" id="ba_race_map">
<img alt="img not found" src="/assets/ba_sentiment_assets/ba_race_map.png">
<figcaption>
Data from the <em>2010 United States Census Summary File 1</em>. United States Census Bureau<br>
Each dot is 25 people: <span id="red_color">White</span>, <span id="blue_color">African American</span>, <span id="green_color">Asian</span>, <span id="orange_color">Hispanic</span>, or Other (yellow)<br>
Map by Eric Fischer: <a href="https://www.flickr.com/photos/walkingsf/5560477152/">https://www.flickr.com/photos/walkingsf/5560477152/</a>
</figcaption>
</figure>
</center></p>
<p>Furthermore, these racial clusters tend to define the cities they are in. Despite being in close proximity with each other, each city has its own distinct culture. This is what provoked the question in the beginning of this post. What if we figure out which cities are happier than others at certain points in time? With this classification, we can possibly find out what people are happy or concerned about, something we can't do without surveys and directly interacting with people.</p>
<h2>Data Gathering</h2>
<h3>Training Dataset</h3>
<p>I used the Sentiment140 dataset. It has a large dataset of tweets which the algorithmically determined was either positive or negative based on emojis and keywords. This was the only dataset I found that was large enough to train a neural network.</p>
<h3>Test Dataset</h3>
<p>I combined two test datasets. The first one is provided by <a href="http://help.sentiment140.com/for-students">Sentiment140</a>, the second is created by <a href="https://github.com/zfz/twitter_corpus">Sanders Analytics</a>. It's important to note that didn't use Sentiment140's neutral tweets, and instead relied on Sanders Analyitcs neutral tweets. Since I trained the model on only positive and negative tweets, having a large number of neutral tweets to adjust thresholds to classify neutrality isn't feasible. I looked over both datasets and I chose Sanders Analytics' neutral because the tweets were more diverse.</p>
<h3>Application Dataset</h3>
<p>I had access to a large corpus of geotagged tweets, however, they didn't have the tweet's texts. Twitter's API couldn't find the tweets, likely because it was so long ago. So I decided to create my own dataset.</p>
<p>I gathered all data within 40 miles of the center of the San Francisco Bay from Twitter's API. Twitter has a way of reverse geocoding tweets even if the user doesn't share their location. I gathered 700,000 tweets from this area that were tweeted between April 25th and May 2nd of 2020.</p>
<p>Twitter allows users to set their location. They can set it to anything, it doesn't have to be their location at all. You could live in San Francisco but set your location to Kuala Lumpur. So I only took the tweets that had users who's location was a bay area city. The thought is that if they tweeted from within the bay area and their location is set to a bay area city, then there's a high likelihood that they live in that city. I ended up having about a quarter million tweets in my constructed dataset.</p>
<h2>Models</h2>
<p>The goal is to build a classifier that takes in a tweet and outputs its sentiment, -1 for negative, 0 for neutral, and +1 for positive.</p>
<p>I started with a baseline model of Naive Bayes, however that showed that it was slightly better than guessing. Logistic regression didn't converge. I also didn't try an SVM because the training set had only positive and negative values, yet we also needed to compute the neutral tweets which would use thresholds on probabilites predicted by the classifier, which SVM's aren't necessarily great at. Then, I turned my attention toward neural networks, specifically LSTMs and GRUs. Due to financial and computational constraints, I was limited to Google Collaboratory for this part of the project, so BERT models didn't run well or else I would have fine tuned and compared those as well. Below are the accuracies for each model.</p>
<figure>
<img alt="img not found" class="wp-image-104" src="/assets/ba_sentiment_assets/model_comparison.jpg">
<figcaption>
Numbers in parentheses are the number of units associated to the layer. Each LSTM and GRU layer are bidirectional. Each neural network had a dense layer with 64 output units with a ReLU activation followed by another dense layer with 1 output unit with a sigmoid activation. Also, each neural network had a global spatial dropout of 0.5. Due to computational and time constraints, each network was trained for 3 epochs. Each model is based on the threshold criteria of predicting neutral if the prediction is between 0.3 and 0.7 (not inclusive).
</figcaption></figure>
<p>I chose to go forward with the GRU and convolutional network in bold in the table. This had less parameters than the GRU with 128 units, so this likely had a slightly lower variance. I trained this model for 10 epochs. After analyzing ROC curves to find the best thresholds, the model gave the following confusion matrix.</p>
<p><img alt="img not found" class="wp-image-105" src="/assets/ba_sentiment_assets/confusion_matrix_lstm_conv.png"></p>
<p>When you’re ready to publish, give your post three to five tags that describe your blog’s focus — writing, photography, fiction, parenting, food, cars, movies, sports, whatever. These tags will help others who care about your topics find you in the Reader. Make sure one of the tags is “zerotohero,” so other new bloggers can find you, too.</p>
<h2>Sentiment</h2>
<p>Applying the model to the bay area tweets gives way to the following city sentiment map</p>
<iframe width="100%" height="520" frameborder="0" src="https://cameronmalloy.carto.com/builder/436dbea1-daff-4fdd-b4ad-9dc1264360c3/embed" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>

<p>The map shows an average of all the tweets sentiment values from each city. Comparing just positive and negative tweets versus the overall average including neutral tweets yields similar values. The large number of tweets from each city discouraged me from normalizing any values, since this average is likely to be close to the true average of the city. Almost all cities had large sample sizes (2,000 to 5,000) except a couple small ones like Yountville and St. Helena.</p>
<p>It's important to note that almost every city was positive to an extend on average aside from a couple cities. The bay area seems to be a very positive place! I chose this color scheme, not so that pink and red represents negativity, but rather because those cities are more negative on average compared to the rest of the bay area.</p>
            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Bay Area Twitter Sentiment During a Pandemic&amp;url=/ba-sentiment.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=/ba-sentiment.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=/ba-sentiment.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="/tag/nlp.html">NLP</a><a href="/tag/deep-learning.html">Deep Learning</a><a href="/tag/clustering.html">Clustering</a>                </aside>

                <div class="clear"></div>


                </section>


                <aside class="post-nav">
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">


          <span class="credits-theme"><a href="https://github.com/cameronmalloy" rel="nofollow" target="_blank">Cameron Malloy</a></span>
          <span class="credits-software">Personal Website</span>
        </section>
      </div>
    </footer>
  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript" src="/theme/js/script.js"></script>

</body>
</html>